<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD</title>
</head>
<body>
    <button id="read">Ler</button>
    <div id="dados"></div>
    <button id="Cadastrar"> <a href="formulario.html">Cadastrar Usuário</a></button><br>
    <button id="signup-link"> <a href="log-user.html">Voltar a tela de login</a></button>
    <script>
        const dadosDiv = document.querySelector('#dados');

        function carregarUsuarios() {
            fetch('http://localhost:3000/users')
            .then(response => response.json())
            .then(data => {
                dadosDiv.innerHTML = '';
                data.forEach(item => {
                    const userDiv = document.createElement('div');
                    userDiv.innerHTML = `
                        ID: ${item.id} |
                        Nome: ${item.name} |
                        Email: ${item.email} |
                        <button class="update-btn" data-id="${item.id}">Update</button>
                        <button class="delete-btn" data-id="${item.id}">Delete</button>
                        <hr>
                    `;

                    dadosDiv.appendChild(userDiv);

                    const updateBtn = userDiv.querySelector('.update-btn');

                    updateBtn.addEventListener('click', () => {

                        const userId = updateBtn.getAttribute('data-id');
                        const newName = prompt('Novo nome:', item.name);
                        const newEmail = prompt('Novo email:', item.email);
                        console.log(`Atualizar usuário com ID: ${userId}`);

                        if (newName !== null && newEmail !== null) {
                            fetch(`http://localhost:3000/users/${userId}`, {
                                method: 'PATCH',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ name: newName, email: newEmail }), // Dados de atualização
                            })
                            .then(response => response.json())
                            .then(updatedUser => {
                                console.log('Usuário atualizado:', updatedUser);
                                // Faça qualquer outra ação necessária após a atualização
                                // Recarregar os usuários após a atualização
                                carregarUsuarios();
                            })
                            .catch(error => console.error(error));
                        }
                    });
                    

                    const deleteBtn = userDiv.querySelector('.delete-btn');
                    deleteBtn.addEventListener('click', () => {
                        const userId = deleteBtn.getAttribute('data-id');
                        console.log(`Deletar usuário com ID: ${userId}`);
                        fetch(`http://localhost:3000/users/${userId}`, {
                            method: 'DELETE',
                        })
                        .then(response => {
                            if (response.ok) {
                                alert('Usuário deletado com sucesso');
                                carregarUsuarios();
                            } else {
                                throw new Error('Erro ao deletar usuário');
                            }
                        })
                        .catch(error => console.error(error));
                    });
                });
            })
            .catch(error => console.error(error));
        }

        document.querySelector('#read').addEventListener('click', carregarUsuarios);
    </script>
</body>
</html>
